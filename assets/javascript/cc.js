var placesResponse,clickedPark,geocodeResponse,latitude,longitude,weatherObservation,weatherForecast,trails,recentSearch=[],config={apiKey:"AIzaSyDCG4DjukKJW_yQ-nGvC1UnF2Q8f6hzP_w",authDomain:"not-used-for-hw.firebaseapp.com",databaseURL:"https://not-used-for-hw.firebaseio.com",projectId:"not-used-for-hw",storageBucket:"not-used-for-hw.appspot.com",messagingSenderId:"532977520995"};firebase.initializeApp(config);var dataRef=firebase.database();
dataRef.ref().orderByChild("dateAdded").limitToLast(4).on("child_added",function(a){var c=a.val().name.trim(),f=a.val().lat;a=a.val().lng;recentSearch.push(c);var b=$("<span>");b.addClass("nav-item nav-link oswald recentSearches");b.attr("data-lat",f);b.attr("data-lng",a);b.attr("data-name",c);b.text(c);$(".navbar-nav").append(b);c=document.getElementsByClassName("recentSearches");4<c.length&&c[0].parentNode.removeChild(c[0])});
var emptyCardsAndParks=function(){$("#cardsHere").empty();$("#sampleParks").empty();var a=$("<h2>");a.addClass("fredericka");a.html("<br>Points of Interest<br>");$("#cardsHere").append(a)},placesTextSearch=function(a,c){var f=$("#destinationSearch").val().trim();$.ajax({url:"https://maps.googleapis.com/maps/api/place/textsearch/json?query="+f+"&key=AIzaSyD6-UaTdmfPpw2x9P0Hf66Rl2XdzCwJvOQ&type="+a,method:"GET"}).then(function(b){console.log(b);placesResponse=b;for(b=0;b<c;b++){var a=$("<div>");a.addClass("card col-md-3 ml-3 mr-3 mb-3 pt-3 attraction");
a.attr("style","width: 18rem;");a.attr("data-id",placesResponse.results[b].id);a.attr("data-lat",placesResponse.results[b].geometry.location.lat);a.attr("data-lng",placesResponse.results[b].geometry.location.lng);a.attr("data-name",placesResponse.results[b].name.trim());var e=$("<div>");e.addClass("card-body");var f=$("<img>");f.addClass("card-img-top");f.attr("src","https://maps.googleapis.com/maps/api/place/photo?maxwidth=350&photoreference="+placesResponse.results[b].photos[0].photo_reference+
"&key=AIzaSyD6-UaTdmfPpw2x9P0Hf66Rl2XdzCwJvOQ");f.attr("alt",placesResponse.results[b].name.trim());var g=$("<h5>");g.addClass("card-title fredericka");g.text(placesResponse.results[b].name.trim());e.append(g);a.append(f);a.append(e);$("#cardsHere").append(a)}})};
(function(){var a=[].slice,c=window.location.protocol+"//"+window.location.host,f=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var b=a.call(arguments),d=/^https?:\/\/([^\/]+)/i.exec(b[1]);d&&d[0].toLowerCase()!==c&&"cors-anywhere.herokuapp.com"!==d[1]&&(b[1]="https://cors-anywhere.herokuapp.com/"+b[1]);return f.apply(this,b)}})();
$(document).on("click",".park-button",function(a){a.preventDefault();clickedPark=$(this).data("park");console.log(clickedPark);$("#destinationSearch").val(clickedPark);geolocateThenWeatherSearch();emptyCardsAndParks();placesTextSearch("campground",6);setTimeout(function(){placesTextSearch("parking",2)},1E3);window.scrollTo(0,620);map.panTo(new google.maps.LatLng($(this).data("lat"),$(this).data("lng")));map.setZoom(10);markers.forEach(function(a){a.setMap(null)});markers=[];markers.push(new google.maps.Marker({position:{lat:$(this).data("lat"),
lng:$(this).data("lng")},map:map,title:$(this).data("park")}))});
$(document).on("click",".recentSearches",function(a){clickedPark=$(this).data("name");console.log(clickedPark);$("#destinationSearch").val(clickedPark);geolocateThenWeatherSearch();emptyCardsAndParks();placesTextSearch("campground",6);setTimeout(function(){placesTextSearch("parking",2)},1E3);window.scrollTo(0,620);map.panTo(new google.maps.LatLng($(this).data("lat"),$(this).data("lng")));map.setZoom(10);markers.forEach(function(a){a.setMap(null)});markers=[];markers.push(new google.maps.Marker({position:{lat:$(this).data("lat"),
lng:$(this).data("lng")},map:map,title:$(this).data("park")}))});$(document).on("click",".attraction",function(a){window.scrollTo(0,620);map.panTo(new google.maps.LatLng($(this).data("lat"),$(this).data("lng")));map.setZoom(15);markers.forEach(function(a){a.setMap(null)});markers=[];markers.push(new google.maps.Marker({position:{lat:$(this).data("lat"),lng:$(this).data("lng")},map:map,title:$(this).data("name")}))});
var renderTrail=function(){$("#trails").empty();var a=$("<h2>");a.addClass("fredericka");a.html("<br>Closest Hiking Trails<br>");$("#trails").append(a);for(a=0;a<trails.length;a++){var c=$("<div>");c.addClass("card col-md-3 ml-3 mr-3 mb-3 pt-3 suggested-trail");c.attr("style","width: 18rem;");var f=$("<div>");f.addClass("card-body");var b=$("<img>");b.addClass("card-img-top");b.attr("src",trails[a].imgSmallMed);b.attr("alt",trails[a].name);var d=$("<h5>");d.addClass("card-title fredericka");d.text(trails[a].name);
var e=$("<p>");e.addClass("card-text oswald");e.html("<br>Location: "+trails[a].location);var h=$("<p>");h.addClass("card-text oswald");h.html("<br>Total distance: "+trails[a].length+" miles");var g=$("<p>");g.addClass("card-text oswald");g.html("<br>Elevation: "+trails[a].ascent+" feet");var k=$("<p>");k.addClass("card-text oswald");k.html("<br>Average Rating: "+trails[a].stars+" stars/5 ("+trails[a].starVotes+" ratings)");var l=$("<p>");l.addClass("card-text oswald");l.html("<br>"+trails[a].summary);
k.append(l);g.append(k);h.append(g);e.append(h);d.append(e);f.append(d);c.append(b);c.append(f);$("#trails").append(c)}},renderSuggestedGearCards=function(a){for(var c=0;c<a.length;c++){var f=$("<div>");f.addClass("card col-md-3 ml-3 mr-3 mb-3 pt-3 suggested-gear");f.attr("style","width: 18rem;");var b=$("<div>");b.addClass("card-body");var d=$("<img>");d.addClass("card-img-top");d.attr("src",a[c].src);d.attr("alt",a[c].name);var e=$("<h4>");e.addClass("card-title fredericka");e.text(a[c].name);var h=
$("<div>"),g=$("<a>");g.addClass("btn btn-success oswald mb-4");g.attr("href",a[c].href);g.attr("target","_blank");g.text("Show me my options!");h.append(g);b.append(e);f.append(d);f.append(b);f.append(h);$("#gearDiv").append(f)}},renderSuggestedGear=function(){var a=[{name:"Camelbak",src:"assets/images/hot/camelbak.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=camelbak"},{name:"Cooler",src:"assets/images/hot/cooler.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss_1?field-keywords=camping+coolers"},
{name:"Sun hats",src:"assets/images/hot/sunhat.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=sun+hat"},{name:"Portable fan and spraybottle",src:"assets/images/hot/waterfan.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=water+fan"}],c=[{name:"Instant heat handwarmer",src:"assets/images/cold/instantheat.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=instant+heat+pack"},{name:"Jacket",src:"assets/images/cold/jacket.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=cold+weather+jacket"},
{name:"Cold weather sleeping bag",src:"assets/images/cold/sleepingbag.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=sleeping+bag"},{name:"Gloves",src:"assets/images/cold/snowgloves.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=cold+weather+gloves"},{name:"Sweater",src:"assets/images/cold/sweater.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=outdoor+sweater"}],f=[{name:"Boots",src:"assets/images/regulartemp/boot.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=hiking+boots"},
{name:"Water bottle",src:"assets/images/regulartemp/bottle.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=reusable+water+bottle"},{name:"Bug spray",src:"assets/images/regulartemp/bugspray.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=bug+spray"},{name:"First aid kit",src:"assets/images/regulartemp/firstaid.jpg",href:"https://www.amazon.com/s/ref=nb_sb_noss?field-keywords=first+aid"}];$("#gear").empty();var b=$("<div>");b.addClass("row text-center mt-3 mb-3");
var d=$("<div>");d.addClass("col-md");var e=$("<h2>");e.addClass("fredericka");e.text("Suggested gear");d.append(e);b.append(d);$("#gear").append(b);b=$("<div>");b.addClass("row justify-content-center text-center");b.attr("id","gearDiv");$("#gear").append(b);30<weatherObservation.temp_c?renderSuggestedGearCards(a):10>weatherObservation.temp_c?renderSuggestedGearCards(c):renderSuggestedGearCards(f)},renderWeather=function(){$("#weather").empty();var a=$("<div>");a.addClass("row text-center mt-3 mb-4");
var c=$("<div>");c.addClass("col-md");var f=$("<h2>");f.addClass("fredericka");f.text("Weather");c.append(f);a.append(c);$("#weather").append(a);a=$("<div>");a.addClass("row justify-content-center mx-auto oswald");c=$("<div>");c.addClass("col-md-12 justify-content-center mx-auto mb-3");f=$("<div>");f.addClass("card mx-auto");f.attr("style","width: 26rem;");var b=$("<div>");b.addClass("card-header text-center");var d=$("<h3>");d.text($("#destinationSearch").val());d.addClass("oswald");var e=$("<img>");
e.attr("alt",weatherObservation.icon);e.attr("src",weatherObservation.icon_url);d.append("<br>Current conditions ");d.append(e);b.append(d);f.append(b);e=$("<ul>");e.addClass("list-group list-group-flush");b=$("<li>");b.addClass("list-group-item");b.text("Weather: "+weatherObservation.weather);e.append(b);b=$("<li>");b.addClass("list-group-item");b.text("Temperature: "+weatherObservation.temperature_string);e.append(b);b=$("<li>");b.addClass("list-group-item");b.text("Feels like: "+weatherObservation.feelslike_string);
e.append(b);b=$("<li>");b.addClass("list-group-item");b.text("Wind: "+weatherObservation.wind_string);e.append(b);f.append(e);c.append(f);a.append(c);$("#weather").append(a);a=$("<div>");a.addClass("row mt-3");c=$("<div>");c.addClass("col-md-8 mx-auto justify-content-center");f=$("<table>");f.addClass("table table-striped");e=$("<thead>");b=$("<tr>");d=$("<th>");d.attr("scope","col");d.text("Day");b.append(d);d=$("<th>");d.addClass("text-center");d.attr("scope","col");d.attr("colspan",2);d.text("Forecasted Conditions");
b.append(d);e.append(b);f.append(e);b=$("<tbody>");for(d=0;d<weatherForecast.txt_forecast.forecastday.length;d++){var h=$("<tr>");e=$("<td>");e.text(weatherForecast.txt_forecast.forecastday[d].title);h.append(e);var g=$("<td>");e=$("<img>");e.attr("alt",weatherForecast.txt_forecast.forecastday[d].icon);e.attr("src",weatherForecast.txt_forecast.forecastday[d].icon_url);g.append(e);h.append(g);e=$("<td>");e.text(weatherForecast.txt_forecast.forecastday[d].fcttext);h.append(e);b.append(h)}f.append(b);
c.append(f);a.append(c);$("#weather").append(a);renderSuggestedGear()},trailSearch=function(){$.ajax({url:"https://www.hikingproject.com/data/get-trails?lat="+latitude+"&lon="+longitude+"&maxDistance=10&key=200268815-4f75cb4511228bcd2861fe407fc89421",method:"GET"}).then(function(a){console.log(a);trails=a.trails;renderTrail()})},weatherSearch=function(){$.ajax({url:"https://api.wunderground.com/api/a44fd7abe0ac90f0/forecast/geolookup/conditions/q/"+latitude+","+longitude+".json",method:"GET"}).then(function(a){console.log(a);
weatherObservation=a.current_observation;weatherForecast=a.forecast;renderWeather()})},geolocateThenWeatherSearch=function(){var a=$("#destinationSearch").val();$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?address="+a+"&key=AIzaSyD6-UaTdmfPpw2x9P0Hf66Rl2XdzCwJvOQ",method:"GET"}).then(function(c){geocodeResponse=c;latitude=geocodeResponse.results[0].geometry.location.lat.toFixed(2);longitude=geocodeResponse.results[0].geometry.location.lng.toFixed(2);weatherSearch();trailSearch();
-1===recentSearch.indexOf(a)?dataRef.ref().push({name:a,lat:latitude,lng:longitude,dateAdded:firebase.database.ServerValue.TIMESTAMP}):console.log("Not pushing this search into Firebase, as it is a duplicate.")})};
document.getElementById("destinationSearch").onkeypress=function(a){if(13==a.keyCode||13==a.which)""===document.getElementById("destinationSearch").value?document.getElementById("errorMsg").textContent="Don't just leave the search box blank.  Type something in!":(document.getElementById("errorMsg").textContent="",geolocateThenWeatherSearch(),emptyCardsAndParks(),placesTextSearch("campground",6),setTimeout(function(){placesTextSearch("parking",2)},1E3))};